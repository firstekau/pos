/*! pie-chart - v1.0.0 - 2015-08-12
* https://github.com/n3-charts/pie-chart
* Copyright (c) 2015 n3-charts  Licensed ,  */

(function(){function e(e,t,n){function i(r,i,s,o){var u=e.getDefaultMargins(),a,f,l=function(e){e.width=i[0].parentElement.offsetWidth||900,e.height=i[0].parentElement.offsetHeight||500},c=function(t,n){e.updatePaths(a,t,u,n).updateLegend(a,t,u,n)},h=function(t,n){e.clean(i[0]),l(u),p(t,n,u)},p=function(t,n,r){if(!t||!n)return;n=e.sanitizeOptions(n),a=e.bootstrap(i[0],r),e.draw(a).updatePaths(a,t,r,n).addLegend(a).updateLegend(a,t,r,n)},d=function(){var t=e.addDataForGauge(r.data,r.options);e.clean(i[0]),l(u),a=e.bootstrap(i[0],u),e.draw(a).updatePaths(a,t,u,r.options).addLegend(a).updateLegend(a,t,u,r.options)},v=function(){return f&&t.cancel(f),f=t(d,1),f};n.addEventListener("resize",v),r.$watch("data",function(t,n){t=e.addDataForGauge(t,r.options),a?c(t,r.options):h(t,r.options)},!0),r.$watch("options",function(t){var n=e.addDataForGauge(r.data,t);h(n,t)},!0)}var r={replace:!0,restrict:"E",scope:{data:"=",options:"="},template:"<div></div>",link:i};return r}angular.module("n3-pie-chart",["n3-pie-utils"]).directive("pieChart",e),e.$inject=["$utils","$timeout","$window"]})(),angular.module("n3-pie-utils",[]).factory("$utils",[function(){return{draw:function(e){return e.append("g").attr({id:"n3-pie-arcs"}),this},updatePaths:function(e,t,n,r){var i=this.getTools(n,r),s=function(e){var t=this.__current?this.__current:{startAngle:e.startAngle,endAngle:e.startAngle},n={startAngle:e.startAngle,endAngle:e.endAngle},r=d3.interpolate(t,n);return function(e){return i.arc(r(e))}},o=e.selectAll("#n3-pie-arcs").selectAll(".arc").data(i.pie(t),function(e){return e.data.label});return o.enter().append("path").attr({"class":"arc",id:function(e,t){return"arc_"+t}}).style({fill:function(e){return e.data.color},"fill-opacity":.8}),o.transition().duration(0).attrTween("d",s).each("end",function(e){this.__current={startAngle:e.startAngle,endAngle:e.endAngle}}),o.exit().remove(),this},getTools:function(e,t){var n=this.getRadius(e),r=Math.max(n-t.thickness,0),i=d3.svg.arc().outerRadius(n).innerRadius(r),s=d3.layout.pie().value(function(e){return e.value});return t.mode==="gauge"&&s.sort(null),{pie:s,arc:i}},addLegend:function(e){var t=e.append("g").attr("id","n3-pie-legend");return this},updateLegend:function(e,t,n,r){return r.mode==="gauge"?this.updateGaugeLegend(e,t,n,r):this.updateRegularLegend(e,t,n,r),this},updateRegularLegend:function(e,t,n,r){var i=this,s=this.getRadius(n),o=s-r.thickness,u=t.length*o/10,a=d3.scale.linear().range([-u,u]).domain([0,t.length-1]).nice(),f=e.selectAll("#n3-pie-legend").selectAll(".legend-item").data(t,function(e){return e.label});f.enter().append("text").classed("legend-item",!0).on("mouseover",this.onMouseOver(e)).on("mouseout",this.onMouseOut(e)),f.text(this.getLegendLabelFunction(o)).attr({"text-anchor":"middle",transform:function(e,t){return"translate(0, "+a(t)+")"}}).style({"font-family":"monospace","font-size":Math.max(12,o/10)+"px",fill:function(e){return e.color},"fill-opacity":.8}),f.exit().remove()},updateGaugeLegend:function(e,t,n,r){var i=(this.getRadius(n)-r.thickness)/2;if(i<0)return;var s=e.selectAll("#n3-pie-legend"),o=s.selectAll(".legend-title").data(t.filter(function(e){return!e.__isComplement}));o.enter().append("text").attr({"class":"legend-title","text-anchor":"middle",y:-i/4+"px"}).style({"font-size":Math.max(i/2,12)+"px",fill:function(e){return e.color},"fill-opacity":.8}),o.text(function(e){return e.label}),o.exit().remove();var u=s.selectAll(".legend-value").data(t.filter(function(e){return!e.__isComplement}));u.enter().append("text").attr({"class":"legend-value","text-anchor":"middle",y:i/1.5+"px"}).style({"font-size":i+"px",fill:function(e){return e.color},"fill-opacity":.8}),u.text(function(e){return e.value+(e.suffix||"")}),u.exit().remove()},getLegendLabelFunction:function(e){var t=this;return function(n,r){return e<40?"":e<100?n.label:t.getLegendLabel(n.label,n.value,20)}},onMouseOver:function(e){return function(t,n){var r=function(e){return e.transition().duration(50).style({opacity:function(e,t){return t===n?"1":"0.4"}})};r(e.selectAll(".legend-item")),r(e.selectAll(".arc"))}},onMouseOut:function(e){return function(t,n){var r=function(e){return e.transition().duration(50).style({opacity:1})};r(e.selectAll(".legend-item")),r(e.selectAll(".arc"))}},getLegendLabel:function(e,t,n){if(e==null)return"";var r=[];for(var i=0;i<n;i++)r.push(".");return e+=" ",t=" "+t,e.split("").forEach(function(e,t){r[t]=e}),t.split("").forEach(function(e,i){r[n-t.length+i]=e}),r.join("")},increase_brightness:function(e,t){e=e.replace(/^\s*#|\s*$/g,""),e.length==3&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return"#"+(0|256+n+(256-n)*t/100).toString(16).substr(1)+(0|256+r+(256-r)*t/100).toString(16).substr(1)+(0|256+i+(256-i)*t/100).toString(16).substr(1)},addDataForGauge:function(e,t){if(!t||t.mode!=="gauge"||e.length!==1)return e;e=e.concat();var n="white";return e[0].hasOwnProperty("complementBrightness")?n=this.increase_brightness(e[0].color,e[0].complementBrightness):e[0].hasOwnProperty("colorComplement")&&(n=e[0].colorComplement),e.push({value:t.total-e[0].value,color:n,__isComplement:!0}),e},getDefaultMargins:function(){return{top:10,right:10,bottom:10,left:10}},clean:function(e){d3.select(e).select("svg").remove()},bootstrap:function(e,t){d3.select(e).classed("chart",!0);var n=t.width,r=t.height,i=d3.select(e).append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+t.width*.5+","+t.height*.5+")");return i},getRadius:function(e){var t=e;return Math.min(t.width-t.left-t.right,t.height-t.top-t.bottom)*.5},looksLikeSameSeries:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){if(t[n].label!==e[n].label)return!1;if(t[n].color!==e[n].color)return!1}return!0},sanitizeOptions:function(e){return e.thickness===undefined?e.thickness=20:e.thickness=parseInt(e.thickness),e.mode==="gauge"&&this.sanitizeGaugeOptions(e),e},sanitizeGaugeOptions:function(e){e.total===undefined?e.total=100:e.total=parseInt(e.total)}}}]);