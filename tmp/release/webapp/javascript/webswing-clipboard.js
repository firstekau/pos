webswingRequirejs.define(["jquery","text!templates/clipboard.html","text!templates/paste.html","webswing-util"],function(t,n,r,i){return function(){function f(e){l(e,!0)}function l(e,t){if(u==null)o.cfg.ieVersion&&o.cfg.ieVersion<=11?window.clipboardData.setData("Text",""):e.clipboardData.setData("text/plain",""),o.send({copy:{type:t===!0?"cut":"copy"}});else{var n=u.wsEventData;if(o.cfg.ieVersion&&o.cfg.ieVersion<=11){var r=u.find('div[data-id="ie-clipboard"]'),i=window.clipboardData;n.text!=null&&(e.preventDefault(),i.setData("Text",n.text)),m()}else e=e.originalEvent||e,e.preventDefault(),n.text!=null&&e.clipboardData.setData("text/plain",n.text),n.html!=null&&!o.cfg.ieVersion&&e.clipboardData.setData("text/html",n.html),m()}}function c(e,t){if(o.cfg.hasControl){var n="",r="";if(o.cfg.ieVersion&&o.cfg.ieVersion<=11)n=window.clipboardData.getData("Text"),r=n;else{var i=e.clipboardData||e.originalEvent.clipboardData;n=i.getData("text/plain"),r=i.getData("text/html");if(i.items!=null)for(var s=0;s<i.items.length;s++)if(i.items[s].type.indexOf("image")===0){var u=i.items[s],a=new FileReader;a.onload=function(e){h(t,n,r,e.target.result)},a.readAsDataURL(u.getAsFile());return}}h(t,n,r)}}function h(e,t,n,r){var i={special:!!e};t!=null&&t.length!==0&&(i.text=t),n!=null&&n.length!==0&&(i.html=n),r!=null&&(i.img=r),o.send({paste:i})}function p(e){function b(e,n){u.find(".ws-btn--selected").removeClass("ws-btn--selected"),u.find(".ws-clipboard-item--active").removeClass("ws-clipboard-item--active"),t(e).addClass("ws-btn--selected"),u.find('div[data-id="'+n+'"]').addClass("ws-clipboard-item--active")}u!=null&&m(),o.cfg.rootElement.append(n),u=o.cfg.rootElement.find('div[data-id="copyBar"]'),u.on("mouseleave",function(e){d()}),u.wsEventData=e;var r=u.find('button[data-id="closeBtn"]');r.click(function(){m()}),u.show("fast");var s=u.find('button[data-id="text"]');if(o.cfg.isMac){var a=t("<p>Copy to clipboard with CMD+C</p>");s.after(a),s.remove(),s=a}if(e.text!=null&&e.text.length!==0||e.html!=null&&e.html.length!==0){var f=u.find('div[data-id="textarea"]');e.text!=null&&e.text.length!==0?f.append(t('<pre class="ws-clipboard-text-pre"></pre>').text(e.text)):f.html('<iframe class="ws-clipboard-text-iframe" src="data:text/html;charset=utf-8,'+encodeURIComponent(e.html)+'"></iframe>'),s.on("mouseenter",function(){b(s,"text"),v()})}s.on("click",function(e){document.execCommand("copy")}),b(s,"text");if(e.files!=null&&e.files.length!==0||e.img!=null){if(e.files!=null&&e.files.length!==0){var l=u.find("#wsFileList");for(var c=0;c<e.files.length;c++){var h=e.files[c],p=t("<a>");h.indexOf("#")===0?(p=t("<span>"),p.html(e.files[c].substring(1))):(p.html(e.files[c]),p.on("click",function(e){o.send({copy:{type:"getFileFromClipboard",file:t(e.currentTarget).html()}})})),l.append(p),l.append("<br/>")}}else u.find('div[data-id="files"]').remove();if(e.img!=null){var g=i.getImageString(e.img);u.find('div[data-id="image"]').append('<a target="_blank" download="clipboard.png" href="'+g+'"><img src="'+g+'" id="wsCopyImage" class="ws-clipboard-img-thumb"></a>')}else u.find('div[data-id="image"]').remove();var y=u.find('button[data-id="more"]');y.on("mouseenter",function(){b(y,"more"),v()})}else{var y=u.find('button[data-id="more"]');y.remove()}u.find('div[data-id="contentBar"]').hide()}function d(){u!=null&&(u.find(".ws-btn--selected").removeClass("ws-btn--selected"),u.find('div[data-id="contentBar"]').slideUp("fast"),u.minimized=!0),o.getInput().focus()}function v(){u!=null&&(u.find('div[data-id="contentBar"]').slideDown("fast"),u.minimized=!1)}function m(){u!=null&&(u.hide("fast"),u.remove(),u=null),o.getInput().focus()}function g(e){a!=null&&y(),o.cfg.rootElement.append(r),a=o.cfg.rootElement.find('div[data-id="pasteDialog"]');var t=a.find('div[data-id="title"]');t.html(o.translate(e.title));var n=a.find('div[data-id="message"]');n.html(o.translate(e.message));var i=a.find('textarea[data-id="textarea"]');i.focus(),i.on("paste",function(e){return e.preventDefault(),e.stopPropagation(),c(e,!1),y(),!1});var s=a.find('button[data-id="closeBtn"]');s.on("click",function(e){o.send({paste:{}}),y()})}function y(){a!=null&&(a.hide("fast"),a.remove(),a=null),o.getInput().focus()}var s=this,o;s.injects=o={cfg:"webswing.config",send:"socket.send",getInput:"canvas.getInput",translate:"translate.translate"},s.provides={cut:f,copy:l,paste:c,displayCopyBar:p,displayPasteDialog:g,dispose:m},s.ready=function(){document.addEventListener("copy",l),n=o.translate(n),r=o.translate(r)};var u,a}});