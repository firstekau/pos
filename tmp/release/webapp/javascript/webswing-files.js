webswingRequirejs.define(["jquery","text!templates/upload.html","jquery.iframe-transport","jquery.fileupload"],function(t,n){return function(){function D(e){e.eventType==="AutoUpload"?P(e,i.socketId):e.eventType==="AutoSave"?H(e,i.socketId):e.eventType==="Open"?B(e,i.socketId):e.eventType==="Close"&&j()}function P(e,t){T==null&&F(i),T.closest(i.cfg.rootElement).length===0&&i.cfg.rootElement.append(T),L.val(t),C.prop("multiple",e.isMultiSelection),C.attr("accept",e.filter),I(T)}function H(e,t){A==null&&F(i),A.closest(i.cfg.rootElement).length===0&&i.cfg.rootElement.append(A),O.val(e.selection),I(A)}function B(e,t){f=!1,l==null&&F(i),l.closest(i.cfg.rootElement).length===0&&i.cfg.rootElement.append(l),c.val(t),U(m,p,e.allowDownload),U(S,p,e.allowUpload),U(v,p,e.allowDelete),R(g,e.allowUpload),R(E,e.allowDownload||e.allowUpload||e.allowDelete),x.prop("multiple",e.isMultiSelection),x.attr("accept",e.filter),z(!1),R(l,e.allowDownload||e.allowUpload||e.allowDelete)}function j(){l!=null&&l.closest(i.cfg.rootElement).length!==0&&(a?f=!0:(l.hide("fast"),l.detach())),T!=null&&T.closest(i.cfg.rootElement).length!==0&&(T.hide("fast"),T.detach()),A!=null&&A.closest(i.cfg.rootElement).length!==0&&(A.hide("fast"),A.detach())}function F(){function D(e,t){t.files.forEach(function(e){o.push(e.name)}),s.push(t),z(!0)}function P(e,t){z(!1),t.jqXHR.statusText!="abort"&&(a?(d.append("<p>"+t.jqXHR.responseText+"</p>"),clearTimeout(a)):(d.append("<p>"+t.jqXHR.responseText+"</p>"),I(h)),t.files.forEach(function(e){var t=o.indexOf(e.name);o.splice(t,1)}),a=setTimeout(function(){a=null,d.html(""),h.hide("fast"),f&&j()},7e3))}function H(e,n){var r=parseInt(n.loaded/n.total*100,10),i=t(".ws-progress-bar"),s=t(".ws-progress-text");i.css("width",r+"%"),s.find("em").text(r+"%")}function B(e,n){var r=t(".ws-progress-text");r.find("em").text(i.translate("files.progComplete")),a||W(o),o=[],z(!1),s=[]}function F(e){X("cancelFileSelection"),q()}function q(){W([]),s.forEach(function(e){e.abort()}),z(!1)}function R(){var e=O.val();return e.match(/^[a-zA-Z0-9. _-]*$/)?(d.html(""),h.hide("fast"),!0):(d.html(i.translate("<p>${files.saveInvlidFilename}</p>")),I(h),!1)}i.cfg.rootElement.append(n),l=i.cfg.rootElement.find('div[data-id="uploadBar"]'),c=l.find('input[data-id="fileDialogTransferBarClientId"]'),p=l.find('div[data-id="fileActionButtonGroup"]'),v=l.find('button[data-id="deleteSelectedButton"]'),m=l.find('button[data-id="downloadSelectedButton"]'),S=l.find('div[data-id="fileUploadBtn"]'),g=l.find('div[data-id="fileDropArea"]'),y=l.find('form[data-id="fileupload"]'),E=l.find('button[data-id="cancelBtn"]'),x=l.find('input[data-id="fileInput"]'),b=i.cfg.rootElement.find('div[data-id="fileDialogTransferProgressBar"]'),w=i.cfg.rootElement.find('div[data-id="progress"] .ws-progress-bar'),h=i.cfg.rootElement.find('div[data-id="fileDialogErrorMessage"]'),d=i.cfg.rootElement.find('div[data-id="fileDialogErrorMessageContent"]'),T=i.cfg.rootElement.find('div[data-id="autoUploadBar"]'),N=T.find('form[data-id="autoFileupload"]'),k=T.find('button[data-id="cancelAutoUploadButton"]'),C=T.find('input[data-id="autoFileInput"]'),L=T.find('input[data-id="autoUploadfileDialogTransferBarClientId"]'),A=i.cfg.rootElement.find('div[data-id="autoSaveBar"]'),O=A.find('input[data-id="autoSaveInput"]'),_=A.find('button[data-id="autoSaveButton"]'),M=A.find('button[data-id="cancelAutoSaveButton"]'),b.hide(),T.hide(),T.detach(),A.hide(),A.detach(),l.hide(),l.detach();var e=N.fileupload({xhrFields:{withCredentials:!0},url:i.cfg.connectionUrl+"file",dataType:"json",dropZone:null});e.bind("fileuploadfail",P),e.bind("fileuploadprogressall",H),e.bind("fileuploadadd",D),e.bind("fileuploaddone",B);var r=y.fileupload({xhrFields:{withCredentials:!0},url:i.cfg.connectionUrl+"file",dataType:"json",dropZone:g});r.bind("fileuploadfail",P),r.bind("fileuploadprogressall",H),r.bind("fileuploadadd",D),r.bind("fileuploaddone",B),M.bind("click",F),k.bind("click",F),E.bind("click",F),v.bind("click",function(e){X("deleteFile")}),m.bind("click",function(e){X("downloadFile")}),i.cfg.rootElement.bind("drop",function(e){e.preventDefault()}),O.bind("input",R),_.bind("click",function(e){var t=O.val();R()&&t.length>0&&W([t])}),i.cfg.rootElement.bind("dragover",function(e){u?clearTimeout(u):g.addClass("ws-filebar-dropArea--ondrag"),u=setTimeout(function(){u=null,g.removeClass("ws-filebar-dropArea--ondrag")},100)})}function I(e){e.show("fast")}function q(e){e.hide("fast")}function R(e,t){t?I(e):q(e)}function U(e,t,n){e.detach(),n&&t.append(e)}function z(e){e?(w.css("width","0%"),b.fadeIn(200)):(b.fadeOut(200),w.css("width","0%"))}function W(e){i.send({selected:{files:e}})}function X(e){i.send({events:[{event:{type:e}}]})}function V(e){var t="hiddenDownloader",n=document.getElementById(t);n===null&&(n=document.createElement("iframe"),n.id=t,n.style.display="none",document.body.appendChild(n)),n.src=i.cfg.connectionUrl+e}function J(e){window.open(e,"_blank")}function K(e){window.open(i.cfg.connectionUrl+"print/viewer.html?file="+encodeURIComponent(i.cfg.connectionUrl+e),"_blank")}var r=this,i;r.injects=i={cfg:"webswing.config",socketId:"socket.uuid",send:"socket.send",translate:"translate.translate"},r.provides={process:D,close:j,download:V,link:J,print:K},r.ready=function(){n=i.translate(n)};var s=[],o=[],u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_}});