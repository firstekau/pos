webswingRequirejs.define(["jquery","webswing-util"],function(t,n){return function(){function c(e){h();var t=l;l=[],e!=null&&t.push(e),t.length>0&&r.send({events:t})}function h(e){r.cfg.hasControl&&(s!=null&&(l.push(s),s=null),o!=null&&(l.push(o),o=null),u!=null&&(l.push(u),u=null),a!=null&&(l.push(a),a=null),e!=null&&JSON.stringify(l[l.length-1])!==JSON.stringify(e)&&l.push(e))}function p(){s=null,o=null,u=null,a=null,f=0,l=[]}function d(){i=!1,p(),document.removeEventListener("mousedown",y),document.removeEventListener("mouseout",b),document.removeEventListener("mouseup",w)}function v(){function u(t){var n=[9,12,16,17,18,19,20,27,32,33,34,35,36,37,38,39,40,44,45,46,91,92,93,145,225,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135],i=t.keyCode;n.indexOf(i)!=-1&&(r.cfg.virtualKB||(t.preventDefault(),t.stopPropagation()));var s=x("keydown",e,t);if(!m(s)){g(s)&&!s.key.alt&&t.preventDefault(),a!=null&&h(),a=s;if(s.key.alt&&n.indexOf(i)==-1){t.preventDefault(),t.stopPropagation(),s=x("keypress",e,t);if(t.key.length==1)s.key.character=t.key.charCodeAt(0);else{var o=s.key.keycode;s.key.character=!s.key.shift&&o>=65&&o<=90?o+32:o}h(s)}}return!1}function f(t){var n=x("keypress",e,t);return m(n)||(t.preventDefault(),t.stopPropagation(),a!=null&&(a.key.character=n.key.character),h(n)),!1}function l(t){var n=x("keyup",e,t);return m(n)||(t.preventDefault(),t.stopPropagation(),h(n),c()),!1}if(i)return;var e=r.getCanvas(),t=r.getInput();p(),E(t),n.bindEvent(e,"mousedown",function(n){var r=S(e,n,"mousedown");return s=null,h(r),E(t),c(),!1},!1),n.bindEvent(e,"dblclick",function(n){var r=S(e,n,"dblclick");return s=null,h(r),E(t),c(),!1},!1),n.bindEvent(e,"mousemove",function(t){var n=S(e,t,"mousemove");return s=n,!1},!1),n.bindEvent(e,"mouseup",function(n){var r=S(e,n,"mouseup");return s=null,h(r),E(t),c(),!1},!1),n.bindEvent(e,"mousewheel",function(t){var n=S(e,t,"mousewheel");return s=null,o!=null&&(n.mouse.wheelDelta+=o.mouse.wheelDelta),o=n,t.preventDefault(),t.stopPropagation(),!1},!1),n.bindEvent(e,"DOMMouseScroll",function(t){var n=S(e,t,"mousewheel");return s=null,o!=null&&(n.mouse.wheelDelta+=o.mouse.wheelDelta),o=n,t.preventDefault(),t.stopPropagation(),!1},!1),n.bindEvent(e,"contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.bindEvent(t,"keydown",u,!1),n.bindEvent(e,"keydown",u,!1),n.bindEvent(t,"keypress",f,!1),n.bindEvent(e,"keypress",f,!1),n.bindEvent(t,"keyup",l,!1),n.bindEvent(e,"keyup",l,!1),n.bindEvent(t,"cut",function(e){return e.preventDefault(),e.stopPropagation(),r.cut(e),!1},!1),n.bindEvent(t,"copy",function(e){return e.preventDefault(),e.stopPropagation(),r.copy(e),!1},!1),n.bindEvent(t,"paste",function(e){return e.preventDefault(),e.stopPropagation(),r.paste(e,!1),!1},!1),n.bindEvent(document,"mousedown",y),n.bindEvent(document,"mouseout",b),n.bindEvent(document,"mouseup",w),i=!0}function m(e){var t=g(e),n="keypress"===e.key.type?e.key.character==120||e.key.character==24||e.key.character==99:e.key.character==88||e.key.character==67,r=t&&!e.key.alt&&!e.key.altgr&&!e.key.shift&&n,i="keypress"===e.key.type?e.key.character==118||e.key.character==22||e.key.character==86:e.key.character==86,s=t&&!e.key.alt&&!e.key.altgr&&!e.key.shift&&i;return s||r}function g(e){return r.cfg.isMac?e.key.meta:e.key.ctrl}function y(e){f|=Math.pow(2,e.which)}function b(e){f=0}function w(e){f&=~Math.pow(2,e.which)}function E(e){e.value=" ",e.focus(),e.select()}function S(e,t,n){var r=e.getBoundingClientRect(),i=Math.round(t.clientX-r.left),s=Math.round(t.clientY-r.top),o=0;return n=="mousewheel"&&(o=-Math.max(-1,Math.min(1,t.wheelDelta||-t.detail))),{mouse:{x:i,y:s,type:n,wheelDelta:o,button:n=="mousemove"?0:t.which,buttons:f,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey,timeMilis:Date.now()%864e5}}}function x(e,t,n){var r=n.which;r==0&&n.key!=null&&(r=n.key.charCodeAt(0));var i=n.keyCode;return i==0&&(i=r),{key:{type:e,character:r,keycode:i,alt:n.altKey,ctrl:n.ctrlKey,shift:n.shiftKey,meta:n.metaKey}}}var t=this,r;t.injects=r={cfg:"webswing.config",send:"socket.send",getInput:"canvas.getInput",getCanvas:"canvas.get",cut:"clipboard.cut",copy:"clipboard.copy",paste:"clipboard.paste"},t.provides={register:v,sendInput:c,dispose:d},t.ready=function(){};var i=!1,s=null,o=null,u=null,a=null,f=0,l=[]}});